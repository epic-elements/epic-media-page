<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-pages/iron-pages.html" />
<link rel="import" href="../epic-slider/epic-slider.html" />
<link rel="import" href="../zeal-navbar/zeal-navbar.html" />
<link rel="import" href="../zeal-footer/zeal-footer.html" />
<link rel="import" href="../epic-contentful/epic-contentful.html" />
<link rel="import" href="../epic-polyfills/epic-polyfills.html" />
<link rel="import" href="include-masonry.html" />
<link rel="import" href="include-moment.html" />
<link rel="import" href="../app-route/app-route.html">
<link rel="import" href="../app-route/app-location.html">
<link rel="import" href="../zeal-styles/zeal-styles.html" />
<link rel="import" href="epic-media-detail-page.html" />

<!--
A media landing page

Example:

    <epic-media-page></epic-media-page>

@demo
-->
<dom-module id="epic-media-page">
  <style>
    :host {
      display: block;
      width: 100%;
      margin: 0;
      padding: 0;
      font-family: "Interstate", Helvetica, arial, sans-serif;
    }

    .main {
      width: 100%;
      background-image: url("img/decorative-texture-1.png");
      background-repeat: repeat
    }

    .main a {
      color: #666;
      text-decoration: none;
      text-transform: uppercase
    }

    .main h1 {
      text-align: center;
      font-size: 5em;
      padding: 1em 0;
      text-transform: uppercase;
      background-color: transparent
    }

    .main h2 {
      font-size: 42px;
      text-align: center;
      margin: 1em auto;
      font-weight: bold;
      text-transform: uppercase;
      line-height: normal
    }

    .heroTop {
      padding: 50px 1em;
      background: url("//images.contentful.com/1kzutnf7jc3r/19FGk6Fi9CCEQ0kaQSKs4W/4371f564409a8b243823125f334e8f54/0011_ZEAL_HP_Component1_ALT_MECH.jpg?q=80&w=1680") center center no-repeat;
      background-size: cover;
      color: white;
    }

    .heroTop h1 {
      padding: 0;
      font-size: 5em;
      text-shadow: 0 0 20px rgba(51, 51, 51, 0.5);
      line-height: 300px
    }

    .mediaMentions {
      position: relative;
      width: 90%;
      margin: 0 auto;
      max-width: 1600px;
      display: flex;
      justify-content: flex-start;
      align-items: flex-start;
      align-content: flex-start;
      flex-flow: row wrap;
    }

    .mediaMentions .mention .card .imageBackground {
      position: relative
    }

    /*.mediaMentions .mention .card .imageBackground:after {
      content: ' ';
      background-color: transparent;
      background: linear-gradient(to top, #fff, transparent);
      width: 100%;
      height: 100%;
      position: absolute;
      left: 0;
      top: 0
    }*/

    .mention {
      flex-basis: 33.33%;
      padding: 0 1em;
      box-sizing: border-box;
      margin: 0 0 30px;
    }

    .mention .card {
      width: 100%;
      background: white;
      box-shadow: 0 0 5px #aaa
    }

    .mention .card .imageBackground {
      font-size: 0;
      background-size: cover;
      padding-top: 60%;
      background-position: center center;
    }

    .mention .card .content {
      padding: 15px;
      text-align: center
    }

    .mention .card .content h2 {
      margin: 0;
      font-size: 1.6em;
    }

    .mention .card .content h3 {
      /*font-weight: normal;*/
      /*font-size: 1em;*/
      padding: 0;
    }

    .mention .card .content .details {
      border-right: 0;
      border-left: 0;
      padding: 0;
      text-align: left;
      display: flex;
      flex-flow: row nowrap;
      justify-content: flex-start;
      align-items: stretch;
    }

    .mention .card .content .details p {
      display: inline-block;
      flex-basis: 100%;
      flex-grow: 1;
      margin-bottom: 0;
      padding-right: 1em;
    }

    .mention .card .content .details .startDate {
      text-align: right;
      padding: 0;
      flex-basis: 85px; /* enough room to display a date, ie "02-09-2017" */
      flex-shrink: 0;
    }

    .mention .card .content> * {
      text-align: left
    }

    .mention .card .content a.moreDetails {
      display: inline-block;
      background: #c30;
      padding: 1em 2em;
      margin: 1em auto;
      font-weight: bold;
      color: white;
      letter-spacing: .025em;
    }

    .mention .card .content a.moreDetails:hover {
      background: #a52900;
      cursor: pointer;
    }

    epic-slider {
      width: 100%;
    }

    @media screen and (max-width: 991px) {
      .heroTop h1 {
        line-height: 1em;
        padding: 1em 20px;
        font-size: 4em
      }
      .mention {
        flex-basis: 50%;
      }
      .mention .card .content h2 {
        font-size: 2rem
      }
      .mention .card .content .mentionDetails {
        font-size: 1rem
      }
      .mention .card .content .moreDetails {
        font-size: 1rem
      }
    }

    @media screen and (max-width: 768px) {
      .heroTop {
        padding: 50px 1em
      }
      .heroTop h1 {
        font-size: 3em;
        line-height: 1.5em
      }
      .mention {
        flex-basis: 100%;
        padding: 10px 0 !important
      }
    }
  </style>

  <template>
    <app-route route="[[route]]" pattern="/:slug" data="{{data}}" tail="{{tail}}" active="{{isDetail}}"></app-route>

    <template is="dom-if" if="[[data.slug]]">
      <epic-media-detail-page media-slug="[[data.slug]]"></epic-media-detail-page>
    </template>

    <template is="dom-if" if="[[!data.slug]]">
      <epic-contentful token="7293987ea91368b8cae485aeadc4037af8253ae4706e2fa0400f9a831aa93086" space="1kzutnf7jc3r" content-type="media" entries="{{entries}}"></epic-contentful>

      <zeal-navbar></zeal-navbar>

      <div id="pageContent" class="main">

          <div class="heroTop">
            <h1>Media Mentions</h1>
          </div>

          <h2>Zeal in the Media</h2>

          <div class="mediaMentions">
            <template is="dom-repeat" items="{{mentions}}">
              <div class="mention">
                <div class="card">
                  <div class="imageBackground" style$="background-image: url([[item.featuredImage]]?q=50&w=960);">
                  </div>
                  <div class="content">
                    <h2>[[item.name]]</h2>
                    <div class="details">
                      <p class="location">[[item.publication]]</p>
                      <p class="startDate">[[item.date]]</p>
                    </div>
                    <h3>[[item.teaser]]</h3>
                    <p class="mentionDetails">[[item.truncatedDetails]]</p>
                    <a href="[[item.slug]]" class="moreDetails">Explore More</a>
                  </div>
                </div>
              </div>
            </template>
          </div>

          <!-- featured mentions slider -->
          <epic-slider min-height="500px" slides$="{{featuredMentions}}"></epic-slider>
      </div>

      <zeal-footer></zeal-footer>
  </template>
</template>

  <script>
    Polymer({

      is: 'epic-media-page',

      properties: {
        entries: {
          type: Object,
          value: function() {
            return {};
          }
        },
        mentions: {
          type: Array,
          value: function() {
            return [];
          },
          notify: true
        },
        featuredMentions: {
          type: Array,
          value: function() {
            return [];
          },
          notify: true
        },
        maxDetailsChars: {
          Type: Number,
          value: 150
        }
      },

      observers: [
        'mentionsChanged(mentionss.splices)',
        '_observeEntries(entries)',
      ],

      ready: function() {},

      isFeatured: function(mention) {
        return mention.featuredMention == true;
      },

      mentionsChanged: function(splices) {
        this.featuredMentions = this.mentions.filter((function(element, index, array) {
          return (element.featuredMention == true)
        }).bind(this));
      },

      _observeEntries: function(response) {
        if (Object.keys(response).length === 0 && response.constructor === Object || !response || response == null) {
          return;
        }

        // update this.mentions
        for (var i = 0; i < response.items.length; i += 1) {

          var truncatedDetails;

          // truncate event details to first x characters
          if (response.items[i].fields.details && response.items[i].fields.details.length > this.maxDetailsChars) {
            truncatedDetails = response.items[i].fields.details.substr(0, this.maxDetailsChars);
            truncatedDetails += '...';
          } else {
            truncatedDetails = response.items[i].fields.details;
          }

          this.push('mentions', {
            'blogUrl': response.items[i].fields.blogUrl,
            'details': response.items[i].fields.details,
            'externalUrl': response.items[i].fields.externalUrl,
            'featuredMention': response.items[i].fields.featuredMention,
            'featuredImage': response.items[i].fields.featuredImage.fields.file.url,
            'publication': response.items[i].fields.publication,
            'name': response.items[i].fields.name,
            'slug': '/media/' + response.items[i].fields.slug,
            'date': response.items[i].fields.date,
            'teaser': response.items[i].fields.teaser,
            'video': response.items[i].fields.video,
            'truncatedDetails': truncatedDetails,
            'heading': response.items[i].fields.name,
            'ctaText': 'Learn More'
          });
        }
      }
    });
  </script>
</dom-module>
